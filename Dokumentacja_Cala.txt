================================================================================
1. OPIS SYSTEMU
================================================================================

# Opis Systemu ServiceDesk

## Wprowadzenie
ServiceDesk to centralna platforma internetowa stworzona do zarządzania wszystkimi zgłoszeniami serwisowymi, technicznymi i prośbami o usługi w organizacji. Jego głównym zadaniem jest usprawnienie komunikacji i przekształcenie chaotycznych zapytań (e-mail, telefon) w uporządkowane, mierzalne zadania (tzw. tickety). System umożliwia użytkownikom zgłaszanie problemów, a administratorom ich obsługę oraz rozwiązywanie problemów.

### Dla Użytkownika (User)
*   **Rejestracja i Logowanie:** Możliwość założenia konta i bezpiecznego logowania (JWT).
*   **Tworzenie Zgłoszeń:** Formularz zgłaszania problemów z wyborem kategorii, priorytetu (domyślnie Medium) i opisem.
*   **Przeglądanie Zgłoszeń:** Lista własnych zgłoszeń z możliwością filtrowania po statusie i wyszukiwania.
*   **Szczegóły Zgłoszenia:** Podgląd szczegółów zgłoszenia i zamieszczonych komentarzy.
*   **Komentowanie:** Możliwość dodawania komentarzy do własnych zgłoszeń w celu doprecyzowania problemu.
*   **Potwierdzanie Rozwiązania:** Możliwość samodzielnego zamknięcia zgłoszenia o statusie "Rozwiązany" (potwierdzenie skuteczności naprawy).
*   **Odrzucanie Rozwiązania:** Możliwość odrzucenia rozwiązania (status "Rozwiązany") i ponownego otwarcia zgłoszenia (status "Otwarty") w przypadku nieskutecznej naprawy.

### Dla Administratora (Admin)
*   **Pełny Dostęp:** Wgląd we wszystkie zgłoszenia w systemie.
*   **Zarządzanie Zgłoszeniami:** Zmiana statusu (Nowy, Otwarty, Rozwiązany). Status "Zamknięty" jest zarezerwowany dla potwierdzenia przez użytkownika.
*   **Statystyki:** Dashboard ze statystykami (wykresy kołowe i słupkowe) prezentującymi rozkład zgłoszeń wg statusu i priorytetu.
*   **Raporty PDF:** Generowanie raportów PDF z listą zgłoszeń.
*   **Zarządzanie Komentarzami:** Moderacja notatek administratora (usuwanie/edycja notatek).
*   **Notatki Wewnętrzne:** Możliwość dodawania notatek widocznych tylko dla administratorów (ukrytych dla zwykłych użytkowników).
*   **Ograniczenia:** Brak możliwości tworzenia nowych zgłoszeń (tylko edycja i zarządzanie).

### Bezpieczeństwo
*   **Automatyczne Wylogowanie:** Sesja użytkownika wygasa po zamknięciu przeglądarki (Session Storage).

## Architektura Systemu
System został zbudowany w architekturze klient-serwer:
*   **Backend:** ASP.NET Core Web API (.NET 7)
    *   Entity Framework Core (ORM)
    *   SQL Server (Baza danych)
    *   Uwierzytelnianie JWT
*   **Frontend:** React (Vite)
    *   Komunikacja z API przez Axios
    *   Stylowanie: CSS Modules / Vanilla CSS (Glassmorphism design)
    *   Wykresy: Recharts
    *   PDF: QuestPDF (Backend)

## Baza Danych
Baza danych SQL Server przechowuje informacje o:
*   Użytkownikach (Users)
*   Zgłoszeniach (Tickets)
*   Kategoriach (Categories)
*   Komentarzach (Comments)

Wykorzystano procedury składowane, widoki oraz triggery do optymalizacji operacji bazodanowych i zapewnienia spójności danych.


================================================================================
2. DIAGRAM ERD
================================================================================

# Diagram ERD Bazy Danych ServiceDesk

Kod diagramu (Mermaid):
```mermaid
erDiagram
    Users ||--o{ Tickets : "tworzy"
    Users ||--o{ Comments : "pisze"
    Categories ||--o{ Tickets : "kategoryzuje"
    Tickets ||--o{ Comments : "posiada"

    Users {
        int Id PK
        string Username
        string PasswordHash
        string Role
    }

    Categories {
        int Id PK
        string Name
    }

    Tickets {
        int Id PK
        string Title
        string Description
        string Status
        string Priority
        datetime CreatedAt
        datetime UpdatedAt
        int UserId FK
        int CategoryId FK
    }

    Comments {
        int Id PK
        string Content
        datetime CreatedAt
        bool IsInternal
        int TicketId FK
        int UserId FK
    }
```

## Opis Relacji
1.  **Users - Tickets (1:N):** Jeden użytkownik może utworzyć wiele zgłoszeń. Każde zgłoszenie należy do jednego użytkownika.
2.  **Users - Comments (1:N):** Jeden użytkownik może napisać wiele komentarzy. Każdy komentarz należy do jednego użytkownika.
3.  **Categories - Tickets (1:N):** Jedna kategoria może być przypisana do wielu zgłoszeń. Zgłoszenie należy do jednej kategorii.
4.  **Tickets - Comments (1:N):** Jedno zgłoszenie może mieć wiele komentarzy. Komentarz jest przypisany do konkretnego zgłoszenia.


================================================================================
3. WYKAZ PROCEDUR SKŁADOWANYCH, FUNKCJI I WYZWALACZY
================================================================================
## Procedury Składowane
1.  **`GetTicketStatistics`**
    *   **Opis:** Zwraca statystyki zgłoszeń, grupując je po statusie i zliczając wystąpienia. Wykorzystywana do generowania wykresów na Dashboardzie.
    *   **Parametry:** Brak.
2.  **`GetUserTicketsWithDetails`**
    *   **Opis:** Pobiera szczegółową listę zgłoszeń dla konkretnego użytkownika, dołączając nazwę kategorii oraz liczbę komentarzy.
    *   **Parametry:** `@UserId` (INT).
3.  **`GetUserTickets`**
    *   **Opis:** Pobiera podstawową listę zgłoszeń przypisanych do użytkownika.
    *   **Parametry:** `@UserId` (INT).
4.  **`UpdateTicketStatus`**
    *   **Opis:** Aktualizuje status zgłoszenia oraz ustawia datę ostatniej modyfikacji (`UpdatedAt`).
    *   **Parametry:** `@TicketId` (INT), `@NewStatus` (NVARCHAR).

## Funkcje
1.  **`dbo.CalculateAverageResolutionTime()`**
    *   **Opis:** Oblicza średni czas (w godzinach) potrzebny na rozwiązanie zgłoszenia (różnica między `CreatedAt` a `UpdatedAt` dla zgłoszeń o statusie 'Resolved').
    *   **Zwraca:** FLOAT (średnia liczba godzin).
2.  **`GetTicketCount`**
    *   **Opis:** Zwraca całkowitą liczbę zgłoszeń utworzonych przez danego użytkownika.
    *   **Parametry:** `@UserId` (INT).
    *   **Zwraca:** INT.

## Wyzwalacze (Triggers)
1.  **`UpdateTicketModifiedDate`** (Tabela: `Tickets`)
    *   **Typ:** `AFTER UPDATE`
    *   **Opis:** Automatycznie aktualizuje kolumnę `UpdatedAt` na bieżącą datę i czas (`GETDATE()`) przy każdej modyfikacji rekordu zgłoszenia.
2.  **`trg_UpdateTicketTimestamp`** (Tabela: `Tickets`)
    *   **Typ:** `AFTER UPDATE`
    *   **Opis:** Mechanizm dublujący funkcjonalność aktualizacji czasu modyfikacji (pozostałość po wcześniejszych migracjach).


================================================================================
4. PREZENTACJA SYSTEMU (ZRZUTY EKRANU)
================================================================================
1. Panel startowy
2. Ekran logowania
3. Ekran rejestracji
4. Dashboard (widok administratora)
5. Dashboard (widok użytkownika)
6. Formularz nowego zgłoszenia
7. Edycja zgłoszenia
8. Szczegóły zgłoszenia (widok administratora)
9.Szczegóły zgłoszenia (widok użytkownika)

================================================================================
5. INSTRUKCJA URUCHOMIENIA
================================================================================

# Instrukcja Uruchomienia Projektu ServiceDesk

## Wymagania
*   .NET 7 SDK (lub nowszy)
*   Node.js (v18+)
*   SQL Server (LocalDB lub pełna instancja)

## Krok 1: Konfiguracja Bazy Danych
1.  Otwórz plik `appsettings.json` w folderze `ServiceDesk` (Backend).
2.  Dostosuj `ConnectionStrings:DefaultConnection` do swojej instancji SQL Server.
3.  Uruchom migracje, aby utworzyć bazę danych:
    ```bash
    cd ServiceDesk
    dotnet ef database update
    ```

## Krok 2: Uruchomienie Backend
1.  W terminalu przejdź do katalogu projektu backendowego:
    ```bash
    cd ServiceDesk
    ```
2.  Uruchom aplikację:
    ```bash
    dotnet run
    ```
    API będzie dostępne pod adresem `http://localhost:5054`.

## Krok 3: Uruchomienie Frontend
1.  W nowym oknie terminala przejdź do folderu `Frontend`:
    ```bash
    cd Frontend
    ```
2.  Zainstaluj zależności (jeśli uruchamiasz pierwszy raz):
    ```bash
    npm install
    ```
3.  Uruchom serwer deweloperski:
    ```bash
    npm run dev
    ```
    Aplikacja będzie dostępna pod adresem `http://localhost:5173`.
